<!DOCTYPE html>
<html lang="en">

<head>
    <title>Expense Tracker App</title>
    <link rel="stylesheet" href="/css/expense.css">
</head>

<body>
    <div>
        <form onsubmit="saveExpense(event)">
            <h2>Expense Tracker</h2>
            <div>
                <label for="amount">Expense Amount</label>
                <input type="text" id="amount" name="amount">
                <label for="description">Description</label>
                <input type="text" id="description" name="description">
                <label for="category">Choose Category</label>
                <select name="category" id="category">
                    <option value="">Select a Category</option>
                    <option value="Movie">Movie</option>
                    <option value="Food">Food</option>
                    <option value="Travel">Travel</option>
                    <option value="Fuel">Fuel</option>
                </select>
                <button>Add Expenses</button>
            </div>
            <ul id="listofExpense"></ul>
        </form>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.4.0/axios.min.js"></script>
    <script>
        function saveExpense(event) {
            event.preventDefault();
            const amount = event.target.amount.value;
            const description = event.target.description.value;
            const category = event.target.category.value;
            const data = {
                amount,
                description,
                category
            }
            axios.post("http://localhost:4500/expense/add-expense",data)
                .then((response) => {
                    console.log(response);
                    showExpense(response.data.expenseData);
                })
                .catch(err => console.log(err))
            event.target.reset();
        }

        window.addEventListener("DOMContentLoaded", () => {
            axios.get("http://localhost:4500/expense/get-expense")
                .then((response) => {
                    console.log(response);
                    for(var i=0; i<response.data.allExpenses.length; i++){
                        showExpense(response.data.allExpenses[i]);
                    }
                })
                .catch(err => console.log(err))
        })

        function showExpense(obj) {
            document.getElementById('amount').value = '';
            document.getElementById('description').value = '';
            document.getElementById('category').value = '';
            
            const parentNode = document.getElementById('listofExpense');
            const childHTML = `<li id=${obj.id}> ${obj.amount} - ${obj.description} - ${obj.category}
                                <button onclick=deleteExpense('${obj.id}')> Delete </button>
                               </li>`;
            
            parentNode.innerHTML = parentNode.innerHTML + childHTML;
        }

        function deleteExpense(id){
            axios.delete(`http://localhost:4500/expense/delete-expense/${id}`)
                .then((response) => {
                    removeExpenseFromScreen(id)
                })
                .catch(err => console.log(err))
        }

        function removeExpenseFromScreen(id){
            const parentNode = document.getElementById('listofExpense');
                const childNodeToBeDeleted = document.getElementById(id);
                if(childNodeToBeDeleted){
                    parentNode.removeChild(childNodeToBeDeleted)
                }
        }
    </script>


</body>

</html>